<!DOCTYPE html>
<!-- saved from url=(0041)http://localhost:4000/python_cheat_sheet/ -->
<html lang="en" class=" js "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

<!-- begin _includes/seo.html --><title>Pandas Python 慣用句 - Python Cheat Sheet</title>
<meta name="description" content="目次    文字の強調   21人以上にフィルタリングする   データフレームをCSVファイルで書き出す   Table  1 2 3 4 |左寄せ|真ん中|右寄せ| |:-----|:----:|-----:| |1-1|1-2|1-3| |2-1|2-2|2-3|                  左寄せ       真ん中       右寄せ                       1-1       1-2       1-3                 2-1       2-2       2-3           枠で囲む  1 2 3 　&lt;div style=&quot;padding: 20px; margin-bottom: 10px; border: 3px solid #DF1452; border-radius: 8px;&quot;&gt;    ここにテキストはいる 　&lt;/div&gt;       ここにテキストはいる　border: 3px solid #DF1452; border-radius: 8px;      ここにテキストはいる　border: 3px solid #092CDB; border-radius: 12px;      ここにテキストはいる　 border: 7px dashed #DF8914; border-radius: 5px;      ここにテキストはいる　 border: 3px double #14DF20; border-radius: 5px; border-width: thick;   見出し  1 2 3 4 5 6 7 &lt;div style=   &quot;position: relative;   padding: 1rem 2rem;   text-align: center;   border: 3px solid #000;&quot;&gt; ここにテキストはいる &lt;/div&gt;    ここにテキストはいる      ここにテキストはいる   文字の強調  1 　`ascending = False`{:style=&quot;background: #ff0044; color: white; font-size: 150%&quot;}   150% で白抜き文字、赤背景  　ascending = False  #f5e964 : 黄色 #ff0044 : コバルトブルー  1 2 `git@github.com:`{:style=&quot;background: #f5e964; font-size: 120%&quot;}  `git@github.com:`{:style=&quot;background: #64f5eb; font-size: 120%&quot;}    git@github.com:    git@github.com:  :::note info インフォメーション infoは省略可能です。 :::  データフレームの各列の列名、ユニーク数、型、NaNの数の一覧表を作成する  1 2 3 4 df_overview = pd.DataFrame([[i, len(df[i].unique()), df[i].dtypes, df[i].isnull().sum()]      for i in df.columns], columns=[&#39;Feature&#39;, &#39;Unique Values&#39;, &#39;dtypes&#39;, &#39;NaN&#39;])  df_overview   21人以上にフィルタリングする  1 2 3    print(df.shape)    df = df[df[&#39;労働者総数&#39;] &gt;= 21]    print(df.shape)   NaNの行を取る  1 2 3    print(df.shape)    df = df[df[&#39;会社数&#39;].isnull() == False]    print(df.shape)   データフレームをCSVファイルで書き出す  インデックス値は不要     df.to_csv(&#39;61_法人番号_dup.csv&#39;, encoding=&#39;utf-8&#39;,  index=False)  適用事業所番号の列の桁数をチェックする。　  最初がゼロの場合、Excel 通してゼロになっている場合があるため 桁数が 10桁のところがあるので、全てを11桁に統一させる 先頭の2桁を抜き出す  1 2 3 4 5 6    df[&#39;適用事業所番号&#39;]=df[&#39;適用事業所番号&#39;].astype(str)    df[&#39;length&#39;]=list(map(len,df[&#39;適用事業所番号&#39;]))    df[&#39;length&#39;].value_counts()      s = df[&#39;適用事業所番号&#39;]    df[&#39;適用事業所番号&#39;]=pd.DataFrame(s.str.zfill(11))   先頭の2桁を抜き出す　  string なので、それをnumeric に変換する  抜き出した都道府県番号が47個あるか確認する。  1 2   df[&#39;都道府県番号&#39;] = df[&#39;適用事業所番号&#39;].str[:2]   df[&#39;都道府県番号&#39;] = pd.to_numeric(df[&#39;都道府県番号&#39;],errors = &#39;coerce&#39; )   s.str[2:6]で6桁の申請日のうち、3,4,5,6 を取り出す。　これが mmdd である    df[&#39;日月&#39;] = df[&#39;申請日&#39;].str[2:6]  列名 length は不要なので、その列を drop する   df = df.drop(columns=[&#39;length&#39;])  列名「法人番号」を「会社数」に変更する   df.rename(columns={&#39;法人番号&#39;: &#39;会社数&#39;}, inplace = True)  列名を指定してデータフレームを再編成する    df = df.loc[:, [&#39;法人番号&#39;, &#39;適用事業所番号&#39;,&#39;法人名&#39;, &#39;住所&#39;, &#39;労働者総数レンジ&#39;, &#39;都道府県名&#39;, &#39;産業大分類名&#39;]]  列名「法人名かな」に含まれる全角をなくす    df[&#39;法人名かな&#39;]=df[&#39;法人名かな&#39;].str.replace(&quot;　&quot;, &quot;&quot;)  オリジナル６１データに含まれていた列 Unnamed 130 から　139 までを削除する  1 2 3 4 5 6 7 8 9 10 11 12 df=df.drop(columns=[     &#39;Unnamed: 130&#39;,     &#39;Unnamed: 131&#39;,     &#39;Unnamed: 132&#39;,     &#39;Unnamed: 133&#39;,     &#39;Unnamed: 134&#39;,     &#39;Unnamed: 135&#39;,     &#39;Unnamed: 136&#39;,     &#39;Unnamed: 137&#39;,     &#39;Unnamed: 138&#39;,     &#39;Unnamed: 139&#39;                    ])   データフレームの列名を縦にリストする  1 2 3 4 pd.options.display.max_rows = 220 columns = df.columns columns = pd.DataFrame(columns) columns.head(220)   抜き出した都道府県番号が47個あるか確認する  df[&#39;都道府県番号&#39;].nunique()  法人番号の列内のNaNの総数を出す  df[&#39;法人番号&#39;].isnull().sum()  NaN を 9999 で埋める　fillna(9999) で行う  df[&#39;法人番号&#39;]=df[&#39;法人番号&#39;].fillna(9999)  申請日の列の型をdatetime 型　dtype(‘&lt;M8[ns]’)にする  df[&#39;申請日&#39;]=pd.to_datetime(df[&#39;申請日&#39;])  法人番号で重複排除する  1 2 3 print(df.shape) df.drop_duplicates(subset=&#39;法人番号&#39;, keep=&#39;first&#39;, inplace=True) print(df.shape)   法人名の処理する前にオリジナルのデータを取っておく  df[&#39;法人名オリジナル&#39;]=df[&#39;法人名&#39;].copy()  法人名についている空白を埋める  df[&#39;法人名&#39;]=df[&#39;法人名&#39;].str.replace(&quot;　&quot;, &quot;&quot;)  SQL DB名：r3_61_227052by137_emp_num_r4.db   SQL Table名： r3_61_227052by137_tab を作成する  1 2 3 4 dbname = &#39;r3_61_227052by137_emp_num_r4.db&#39; conn = sqlite3.connect(dbname) cur = conn.cursor() df.to_sql(&#39;r3_61_227052by137_tab&#39;, conn, if_exists=&#39;replace&#39;)   SQL ヒアドキュメントサンプル  1 2 3 4 5 6 7 8 9 10 11 12 13 14 query = &quot;&quot;&quot;     SELECT              &quot;法人名&quot;,              &quot;都道府県名&quot;,             &quot;労働者総数&quot;,             &quot;産業大分類名&quot;,             &quot;法人番号&quot;     FROM    &quot;r3_61_227052by137_tab&quot;     WHERE   &quot;法人名&quot;      IN      (                 &#39;北海道信用金庫&#39;,             &#39;株式会社エスピー工研&#39;             )   &quot;&quot;&quot;   SQL ヒアドキュメントメインQuery  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 query = &quot;&quot;&quot;     SELECT              &quot;法人名&quot;,              &quot;適用事業所番号&quot;,             &quot;法人番号&quot;,              &quot;住所&quot;,             &quot;定年有無&quot; ,             &quot;定年年齢&quot;,              &quot;継続雇用-希望者最低年齢&quot;,              &quot;労働者総数レンジ&quot;,              &quot;産業大分類名&quot;,              &quot;都道府県名&quot;     FROM    &quot;r3_61_227052by137_tab&quot;     WHERE   &quot;定年有無&quot; == 2 OR             &quot;定年年齢&quot; &gt;= 70 OR             &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND             &quot;産業中分類コード&quot; &lt;&gt; 94 AND             &quot;産業中分類コード&quot; &lt;&gt; 97 AND             &quot;産業中分類コード&quot; &lt;&gt; 98     &quot;&quot;&quot;   display df のフォーマットを指定する  1 2 3 4 5 6 7 format_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,                &#39;法人番号&#39;: &#39;{:.0f}&#39;,                 &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39;               } df.style.format(format_dict)   SQL query サンプル  1 2 3 4 5 6 dbname = dbname conn = sqlite3.connect(dbname) cur = conn.cursor() df = pd.read_sql(query, conn) cur.close() conn.close()   Read EXCEL file ファイル名とシート名とIndexとするカラムを指定する。 EXCELにインデクスがない場合は　index_col=None を指定する  1 2 xlsx = pd.ExcelFile(&#39;基準データ2023.xlsx&#39;) df = pd.read_excel(xlsx, &#39;data_2023&#39;, index_col=&#39;idx&#39;, header=0)   読み込んだdfからヒートマップを作成  1 2 3 plt.rcParams[&#39;figure.figsize&#39;] = 12, 12 sns.heatmap(df, annot=True, cmap=&#39;BuGn&#39;) plt.savefig(&#39;employment1.png&#39;)   インデックスJoin  df12 = df1.join(df2, rsuffix=&#39;_2&#39;)  カラム”mean” の値の大きい順 ascending = False でソートする  値の大きい順、日付けの新しい順　ascending = False  df = df.sort_values([&quot;mean&quot;], ascending = False)  カラム名　産業大分類名で構成比を成型して表示する  1 2 3 4 5 6 7 8 col_name = &#39;産業大分類名&#39; tab = df[col_name].value_counts() tab = pd.DataFrame(tab) tab = tab.rename_axis(col_name) tab[&#39;構成比&#39;]=(tab[col_name] / tab[col_name].sum()) tab.rename(columns={col_name: &#39;会社数&#39;}, inplace = True) format_dict = {&#39;構成比&#39;: &#39;{:.1%}&#39;} display(tab.style.format(format_dict))   CSV file read  1 2 3 import codecs with codecs.open(&quot;WA_Fn-UseC_-HR-Employee-Attrition.csv&quot;, mode =&quot;r&quot;, encoding =&quot;utf-8&quot;, errors=&quot;ignore&quot;) as file:     df = pd.read_csv(file, delimiter =&quot;,&quot;, header=0)   Count Plot サンプル  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import numpy as np import pandas as pd import seaborn as sns # matplotlibのグラフをRetinaの高解像度で表示する %config InlineBackend.figure_formats = {&#39;png&#39;, &#39;retina&#39;} # Jupyter Notebookの中で作図した画像を表示させる %matplotlib inline # matplotlib をインポートする import matplotlib.pyplot as plt # 図のサイズを12inch x 12inch = 864px X 864px にする plt.rcParams[&#39;figure.figsize&#39;] = 12, 12 # 日本語タイトルのため、japanizeをインポートする import japanize_matplotlib plt.rcParams[&#39;font.family&#39;] = &#39;IPAexGothic&#39; # 列を縦にする # plt.xticks(rotation=90) col_name = &#39;YearsAtCompany&#39; sns.countplot(x=col_name, data=df, palette=&#39;hls&#39;) #seaborn countplotを設定し、変数axとしてAnnotationを上書できるようにする ax = sns.countplot(x = col_name,                     data = df) # Annotation を設定する for p in ax.patches:     ax.annotate(format(p.get_height(), &#39;.0f&#39;),                     (p.get_x() + p.get_width() / 2.,                      p.get_height()),                      ha = &#39;center&#39;,                      va = &#39;center&#39;,                      xytext = (0, 9),                      textcoords = &#39;offset points&#39;,                     fontsize = 8,                     color = &#39;blue&#39;)     Openpyxl でExcel file のシート名を確認する  1 2 3 4 5 6 7 8 # ライブラリを読み込む import openpyxl as xl import win32com.client import os  filename = &#39;61_matching_lisr_winner_1221_v2.xlsx&#39; wb = xl.load_workbook(filename) wb.sheetnames   データフレーム df, dt を横に結合させる  df = pd.concat([df, dt], axis = 1)  都道府県番号；都道府県名を一つの要素としてカラム名「都道府県」部分を、「都道府県番号」と「都道府県名」に分割した新しいデータフレーム「dt」を作成する  1 2 3 4 5 6 7 df[&#39;new&#39;] = df[&#39;都道府県&#39;].str.split(&#39;:&#39;) np_array = df[&#39;new&#39;].values np_list = np_array.tolist() dt = pd.DataFrame(np_list) cols = [&#39;都道府県番号&#39;, &#39;都道府県名&#39;] dt.columns = cols display(dt.head())   カラム名「name」をインデクスに変える  df = df.set_index(&#39;name&#39;)  元のインデクス値をインデクスに戻す（リセットする）  df = df.reset_index()  列間を比較し、その結果を 1\9 で出す  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # 必要なモジュールをインポートします import numpy as np import pandas as pd # 演習用のデータフレームを作成します。 # ２番目の北海道と宮城県の顧客番号はint型でその他はstr型でデータフレームを作成 df = pd.DataFrame({ &#39;社員番号&#39;: [&#39;01285679&#39;, &#39;01340788&#39;, &#39;02123782&#39;, &#39;03541976&#39;, &#39;04297411&#39;, &#39;13299899&#39;, &#39;30144450&#39;, &#39;47339981&#39;],                    &#39;記録 列A&#39;:   [4,3,2,1,4,2,3,8],                    &#39;報告 列B&#39;: [4,3,2,2,4,0,3,8]},                     index=[0, 1, 2, 3, 4, 5, 6,7]) # データフレームを表示します display(df)  def func_row_check(row):     &quot;&quot;&quot;     列間を比較する      引数:         row[&#39;col1&#39;]: 比較したい列名 col1         row[&#39;col2&#39;]: 比較したいもう一つの列名 col2      Returns:         1 : 一致         9 : 不一致     &quot;&quot;&quot;     if row[&#39;記録 列A&#39;] == row[&#39;報告 列B&#39;]:         return 1     else:         return 9  df[&#39;結果&#39;] = df.apply(func_row_check, axis = 1)  display(df)   カテゴリ毎に人数出して、整形する  1 2 3 4 5 6 cat = df[col4].value_counts() cat = pd.DataFrame(cat) cat = cat.rename_axis(col4) cat.rename(columns={col4: &#39;人数&#39;}, inplace = True)  display(cat)     カテゴリ集計を円グラフにする  1 2 3 4 5 6 7 8 9 10 11 tot = cat.sum() print(tot) sizes = cat[&#39;人数&#39;] labels = cat.index.tolist() fix1, ax1 = plt.subplots() colors = sns.color_palette(&#39;pastel&#39;)[0:9] ax1.pie(sizes, labels=labels, autopct=&#39;%1.1f%%&#39;, startangle=0, colors=colors)  ax1.axis(&#39;equal&#39;) ax1.set_title(&#39;申し込み者属性&#39;, pad=4, fontsize=12, color=&#39;black&#39;) plt.show()   SPSS データの読み取り　カテゴリカルデータでデータフレームを作成 SPSS データは、ラベル名付きとラベル名なし（数値）の二種類をシートを分割して表示している  df = pd.read_spss(&#39;SPSSデータ20230405.sav&#39;, usecols=None, convert_categoricals=True)  SQL here documens  query = &quot;&quot;&quot;     SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;定年年齢&quot;, &quot;継続雇用制度&quot;,&quot;労働者総数&quot;,&quot;労働者総数レンジ&quot;,              &quot;継続雇用-希望者最低年齢&quot;, &quot;継続雇用-基準最高年齢&quot;, &quot;60〜64歳&quot;, &quot;65〜69歳&quot;, &quot;70歳以上&quot;,              &quot;都道府県名&quot;, &quot;都道府県番号&quot;,&quot;産業大分類名&quot;,&quot;産業大分類コード&quot;,&quot;事業具体的内容&quot;     FROM   r4_61_235875by137_tab     WHERE  &quot;適用事業所番号&quot;      IN (             &#39;07040018408&#39;,         &#39;38046133551&#39;,         &#39;19041009509&#39;,         &#39;24031041347&#39;,         &#39;28050009587&#39;,         &#39;03010054500&#39;,         &#39;23090023395&#39;,         &#39;35030028271&#39;,         &#39;47020004572&#39;,         &#39;45032017649&#39;,         &#39;20040019386&#39;,         &#39;41061002192&#39;,         &#39;20040026435&#39;,         &#39;26071017321&#39;,         &#39;23066143807&#39;,         &#39;23044415753&#39;,         &#39;17010005343&#39;,         &#39;17020009844&#39;,         &#39;08011007115&#39;,         &#39;14015254513&#39;,         &#39;13086280459&#39;         )  &quot;&quot;&quot;  #dbname = &#39;r4_61_235875by137_0118r5.db&#39; conn = sqlite3.connect(dbname) cur = conn.cursor()  # dbをpandasで読み出す。 # WHERE で条件に合致した要素のみを読み込み、それをDataFrame に格納する df1 = pd.read_sql(query, conn)  docker グループにユーザ(user)を追加する     $ docker ps Got permission denied while trying to connect to the Docker daemon  socket at unix:///var/run/docker.sock:  Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json:  dial unix /var/run/docker.sock: connect: permission denied   user@KENKYU01:~$ sudo gpasswd -a user sudo  [sudo] password for user: Adding user user to group sudo  docker conainer  からminimal thema でPublish(bundle exec jekyll server -H 0.0.0.0)する  $ winpty docker run --rm -it --name docker_jekyll     -v /$PWD/_config.yml://work/_config.yml     -v /$PWD/index.html://work/index.html     -v /$PWD/_data/://work/_data/     -v /$PWD/_posts/://work/_posts/     -v /$PWD/_site/://work/_site/     -v /$PWD/images/://work/images/     -v /$PWD/assets/://work/assets/     -p 4000:4000     -w //work     docker_jekyll     bundle exec jekyll serve -H 0.0.0.0  グループの追加ができたことを確認する。ログアウトすること。  user@KENKYU01:~$ id user uid=1000(user) gid=1000(user) groups=1000(user),27(sudo),1001(docker) user@KENKYU01:~$ exit logout  SQL 文　条件追加 and/or/not  format_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,                &#39;法人番号&#39;: &#39;{:.0f}&#39; ,                &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39; }  query = &quot;&quot;&quot;     SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;法人番号&quot;, &quot;住所&quot;,&quot;定年有無&quot; ,&quot;定年年齢&quot;, &quot;継続雇用-希望者最低年齢&quot;, &quot;労働者総数レンジ&quot;, &quot;労働者総数&quot; ,&quot;産業大分類名&quot;, &quot;都道府県名&quot;     FROM &quot;r3_61_227051by137_tab&quot;     WHERE &quot;定年有無&quot; == 2 OR     &quot;定年年齢&quot; &gt;= 70 OR     &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND     &quot;産業中分類コード&quot; &lt;&gt; 94 AND     &quot;産業中分類コード&quot; &lt;&gt; 97 AND     &quot;産業中分類コード&quot; &lt;&gt; 98   &quot;&quot;&quot;  dbname = dbname conn = sqlite3.connect(dbname) cur = conn.cursor() # dbをpandasで読み出す。 df = pd.read_sql(query, conn) cur.close() conn.close()  ２つのデータフレームをIndexをKeyにmerge する。  Merge するキー列をIndexにするため、df.set_index(‘キー列名’)をする  1 2 3 4 5 6 7 8 9 10 df = df.set_index(&quot;事業所番号&quot;) da = df  df = df.set_index(&quot;事業所番号&quot;) dfb = df   df = pd.merge(dfa, dfb, how = &#39;inner&#39;, on = &#39;事業所番号&#39;) OR df = pd.merge(dfa, dfb, how = &#39;outer&#39;, on = &#39;事業所番号&#39;)">


  <meta name="author" content="so-wi.com">
  
  <meta property="article:author" content="so-wi.com">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Python Cheat Sheet">
<meta property="og:title" content="Pandas Python 慣用句">
<meta property="og:url" content="http://0.0.0.0:4000/python_cheat_sheet/">


  <meta property="og:description" content="目次    文字の強調   21人以上にフィルタリングする   データフレームをCSVファイルで書き出す   Table  1 2 3 4 |左寄せ|真ん中|右寄せ| |:-----|:----:|-----:| |1-1|1-2|1-3| |2-1|2-2|2-3|                  左寄せ       真ん中       右寄せ                       1-1       1-2       1-3                 2-1       2-2       2-3           枠で囲む  1 2 3 　&lt;div style=&quot;padding: 20px; margin-bottom: 10px; border: 3px solid #DF1452; border-radius: 8px;&quot;&gt;    ここにテキストはいる 　&lt;/div&gt;       ここにテキストはいる　border: 3px solid #DF1452; border-radius: 8px;      ここにテキストはいる　border: 3px solid #092CDB; border-radius: 12px;      ここにテキストはいる　 border: 7px dashed #DF8914; border-radius: 5px;      ここにテキストはいる　 border: 3px double #14DF20; border-radius: 5px; border-width: thick;   見出し  1 2 3 4 5 6 7 &lt;div style=   &quot;position: relative;   padding: 1rem 2rem;   text-align: center;   border: 3px solid #000;&quot;&gt; ここにテキストはいる &lt;/div&gt;    ここにテキストはいる      ここにテキストはいる   文字の強調  1 　`ascending = False`{:style=&quot;background: #ff0044; color: white; font-size: 150%&quot;}   150% で白抜き文字、赤背景  　ascending = False  #f5e964 : 黄色 #ff0044 : コバルトブルー  1 2 `git@github.com:`{:style=&quot;background: #f5e964; font-size: 120%&quot;}  `git@github.com:`{:style=&quot;background: #64f5eb; font-size: 120%&quot;}    git@github.com:    git@github.com:  :::note info インフォメーション infoは省略可能です。 :::  データフレームの各列の列名、ユニーク数、型、NaNの数の一覧表を作成する  1 2 3 4 df_overview = pd.DataFrame([[i, len(df[i].unique()), df[i].dtypes, df[i].isnull().sum()]      for i in df.columns], columns=[&#39;Feature&#39;, &#39;Unique Values&#39;, &#39;dtypes&#39;, &#39;NaN&#39;])  df_overview   21人以上にフィルタリングする  1 2 3    print(df.shape)    df = df[df[&#39;労働者総数&#39;] &gt;= 21]    print(df.shape)   NaNの行を取る  1 2 3    print(df.shape)    df = df[df[&#39;会社数&#39;].isnull() == False]    print(df.shape)   データフレームをCSVファイルで書き出す  インデックス値は不要     df.to_csv(&#39;61_法人番号_dup.csv&#39;, encoding=&#39;utf-8&#39;,  index=False)  適用事業所番号の列の桁数をチェックする。　  最初がゼロの場合、Excel 通してゼロになっている場合があるため 桁数が 10桁のところがあるので、全てを11桁に統一させる 先頭の2桁を抜き出す  1 2 3 4 5 6    df[&#39;適用事業所番号&#39;]=df[&#39;適用事業所番号&#39;].astype(str)    df[&#39;length&#39;]=list(map(len,df[&#39;適用事業所番号&#39;]))    df[&#39;length&#39;].value_counts()      s = df[&#39;適用事業所番号&#39;]    df[&#39;適用事業所番号&#39;]=pd.DataFrame(s.str.zfill(11))   先頭の2桁を抜き出す　  string なので、それをnumeric に変換する  抜き出した都道府県番号が47個あるか確認する。  1 2   df[&#39;都道府県番号&#39;] = df[&#39;適用事業所番号&#39;].str[:2]   df[&#39;都道府県番号&#39;] = pd.to_numeric(df[&#39;都道府県番号&#39;],errors = &#39;coerce&#39; )   s.str[2:6]で6桁の申請日のうち、3,4,5,6 を取り出す。　これが mmdd である    df[&#39;日月&#39;] = df[&#39;申請日&#39;].str[2:6]  列名 length は不要なので、その列を drop する   df = df.drop(columns=[&#39;length&#39;])  列名「法人番号」を「会社数」に変更する   df.rename(columns={&#39;法人番号&#39;: &#39;会社数&#39;}, inplace = True)  列名を指定してデータフレームを再編成する    df = df.loc[:, [&#39;法人番号&#39;, &#39;適用事業所番号&#39;,&#39;法人名&#39;, &#39;住所&#39;, &#39;労働者総数レンジ&#39;, &#39;都道府県名&#39;, &#39;産業大分類名&#39;]]  列名「法人名かな」に含まれる全角をなくす    df[&#39;法人名かな&#39;]=df[&#39;法人名かな&#39;].str.replace(&quot;　&quot;, &quot;&quot;)  オリジナル６１データに含まれていた列 Unnamed 130 から　139 までを削除する  1 2 3 4 5 6 7 8 9 10 11 12 df=df.drop(columns=[     &#39;Unnamed: 130&#39;,     &#39;Unnamed: 131&#39;,     &#39;Unnamed: 132&#39;,     &#39;Unnamed: 133&#39;,     &#39;Unnamed: 134&#39;,     &#39;Unnamed: 135&#39;,     &#39;Unnamed: 136&#39;,     &#39;Unnamed: 137&#39;,     &#39;Unnamed: 138&#39;,     &#39;Unnamed: 139&#39;                    ])   データフレームの列名を縦にリストする  1 2 3 4 pd.options.display.max_rows = 220 columns = df.columns columns = pd.DataFrame(columns) columns.head(220)   抜き出した都道府県番号が47個あるか確認する  df[&#39;都道府県番号&#39;].nunique()  法人番号の列内のNaNの総数を出す  df[&#39;法人番号&#39;].isnull().sum()  NaN を 9999 で埋める　fillna(9999) で行う  df[&#39;法人番号&#39;]=df[&#39;法人番号&#39;].fillna(9999)  申請日の列の型をdatetime 型　dtype(‘&lt;M8[ns]’)にする  df[&#39;申請日&#39;]=pd.to_datetime(df[&#39;申請日&#39;])  法人番号で重複排除する  1 2 3 print(df.shape) df.drop_duplicates(subset=&#39;法人番号&#39;, keep=&#39;first&#39;, inplace=True) print(df.shape)   法人名の処理する前にオリジナルのデータを取っておく  df[&#39;法人名オリジナル&#39;]=df[&#39;法人名&#39;].copy()  法人名についている空白を埋める  df[&#39;法人名&#39;]=df[&#39;法人名&#39;].str.replace(&quot;　&quot;, &quot;&quot;)  SQL DB名：r3_61_227052by137_emp_num_r4.db   SQL Table名： r3_61_227052by137_tab を作成する  1 2 3 4 dbname = &#39;r3_61_227052by137_emp_num_r4.db&#39; conn = sqlite3.connect(dbname) cur = conn.cursor() df.to_sql(&#39;r3_61_227052by137_tab&#39;, conn, if_exists=&#39;replace&#39;)   SQL ヒアドキュメントサンプル  1 2 3 4 5 6 7 8 9 10 11 12 13 14 query = &quot;&quot;&quot;     SELECT              &quot;法人名&quot;,              &quot;都道府県名&quot;,             &quot;労働者総数&quot;,             &quot;産業大分類名&quot;,             &quot;法人番号&quot;     FROM    &quot;r3_61_227052by137_tab&quot;     WHERE   &quot;法人名&quot;      IN      (                 &#39;北海道信用金庫&#39;,             &#39;株式会社エスピー工研&#39;             )   &quot;&quot;&quot;   SQL ヒアドキュメントメインQuery  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 query = &quot;&quot;&quot;     SELECT              &quot;法人名&quot;,              &quot;適用事業所番号&quot;,             &quot;法人番号&quot;,              &quot;住所&quot;,             &quot;定年有無&quot; ,             &quot;定年年齢&quot;,              &quot;継続雇用-希望者最低年齢&quot;,              &quot;労働者総数レンジ&quot;,              &quot;産業大分類名&quot;,              &quot;都道府県名&quot;     FROM    &quot;r3_61_227052by137_tab&quot;     WHERE   &quot;定年有無&quot; == 2 OR             &quot;定年年齢&quot; &gt;= 70 OR             &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND             &quot;産業中分類コード&quot; &lt;&gt; 94 AND             &quot;産業中分類コード&quot; &lt;&gt; 97 AND             &quot;産業中分類コード&quot; &lt;&gt; 98     &quot;&quot;&quot;   display df のフォーマットを指定する  1 2 3 4 5 6 7 format_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,                &#39;法人番号&#39;: &#39;{:.0f}&#39;,                 &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39;               } df.style.format(format_dict)   SQL query サンプル  1 2 3 4 5 6 dbname = dbname conn = sqlite3.connect(dbname) cur = conn.cursor() df = pd.read_sql(query, conn) cur.close() conn.close()   Read EXCEL file ファイル名とシート名とIndexとするカラムを指定する。 EXCELにインデクスがない場合は　index_col=None を指定する  1 2 xlsx = pd.ExcelFile(&#39;基準データ2023.xlsx&#39;) df = pd.read_excel(xlsx, &#39;data_2023&#39;, index_col=&#39;idx&#39;, header=0)   読み込んだdfからヒートマップを作成  1 2 3 plt.rcParams[&#39;figure.figsize&#39;] = 12, 12 sns.heatmap(df, annot=True, cmap=&#39;BuGn&#39;) plt.savefig(&#39;employment1.png&#39;)   インデックスJoin  df12 = df1.join(df2, rsuffix=&#39;_2&#39;)  カラム”mean” の値の大きい順 ascending = False でソートする  値の大きい順、日付けの新しい順　ascending = False  df = df.sort_values([&quot;mean&quot;], ascending = False)  カラム名　産業大分類名で構成比を成型して表示する  1 2 3 4 5 6 7 8 col_name = &#39;産業大分類名&#39; tab = df[col_name].value_counts() tab = pd.DataFrame(tab) tab = tab.rename_axis(col_name) tab[&#39;構成比&#39;]=(tab[col_name] / tab[col_name].sum()) tab.rename(columns={col_name: &#39;会社数&#39;}, inplace = True) format_dict = {&#39;構成比&#39;: &#39;{:.1%}&#39;} display(tab.style.format(format_dict))   CSV file read  1 2 3 import codecs with codecs.open(&quot;WA_Fn-UseC_-HR-Employee-Attrition.csv&quot;, mode =&quot;r&quot;, encoding =&quot;utf-8&quot;, errors=&quot;ignore&quot;) as file:     df = pd.read_csv(file, delimiter =&quot;,&quot;, header=0)   Count Plot サンプル  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import numpy as np import pandas as pd import seaborn as sns # matplotlibのグラフをRetinaの高解像度で表示する %config InlineBackend.figure_formats = {&#39;png&#39;, &#39;retina&#39;} # Jupyter Notebookの中で作図した画像を表示させる %matplotlib inline # matplotlib をインポートする import matplotlib.pyplot as plt # 図のサイズを12inch x 12inch = 864px X 864px にする plt.rcParams[&#39;figure.figsize&#39;] = 12, 12 # 日本語タイトルのため、japanizeをインポートする import japanize_matplotlib plt.rcParams[&#39;font.family&#39;] = &#39;IPAexGothic&#39; # 列を縦にする # plt.xticks(rotation=90) col_name = &#39;YearsAtCompany&#39; sns.countplot(x=col_name, data=df, palette=&#39;hls&#39;) #seaborn countplotを設定し、変数axとしてAnnotationを上書できるようにする ax = sns.countplot(x = col_name,                     data = df) # Annotation を設定する for p in ax.patches:     ax.annotate(format(p.get_height(), &#39;.0f&#39;),                     (p.get_x() + p.get_width() / 2.,                      p.get_height()),                      ha = &#39;center&#39;,                      va = &#39;center&#39;,                      xytext = (0, 9),                      textcoords = &#39;offset points&#39;,                     fontsize = 8,                     color = &#39;blue&#39;)     Openpyxl でExcel file のシート名を確認する  1 2 3 4 5 6 7 8 # ライブラリを読み込む import openpyxl as xl import win32com.client import os  filename = &#39;61_matching_lisr_winner_1221_v2.xlsx&#39; wb = xl.load_workbook(filename) wb.sheetnames   データフレーム df, dt を横に結合させる  df = pd.concat([df, dt], axis = 1)  都道府県番号；都道府県名を一つの要素としてカラム名「都道府県」部分を、「都道府県番号」と「都道府県名」に分割した新しいデータフレーム「dt」を作成する  1 2 3 4 5 6 7 df[&#39;new&#39;] = df[&#39;都道府県&#39;].str.split(&#39;:&#39;) np_array = df[&#39;new&#39;].values np_list = np_array.tolist() dt = pd.DataFrame(np_list) cols = [&#39;都道府県番号&#39;, &#39;都道府県名&#39;] dt.columns = cols display(dt.head())   カラム名「name」をインデクスに変える  df = df.set_index(&#39;name&#39;)  元のインデクス値をインデクスに戻す（リセットする）  df = df.reset_index()  列間を比較し、その結果を 1\9 で出す  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # 必要なモジュールをインポートします import numpy as np import pandas as pd # 演習用のデータフレームを作成します。 # ２番目の北海道と宮城県の顧客番号はint型でその他はstr型でデータフレームを作成 df = pd.DataFrame({ &#39;社員番号&#39;: [&#39;01285679&#39;, &#39;01340788&#39;, &#39;02123782&#39;, &#39;03541976&#39;, &#39;04297411&#39;, &#39;13299899&#39;, &#39;30144450&#39;, &#39;47339981&#39;],                    &#39;記録 列A&#39;:   [4,3,2,1,4,2,3,8],                    &#39;報告 列B&#39;: [4,3,2,2,4,0,3,8]},                     index=[0, 1, 2, 3, 4, 5, 6,7]) # データフレームを表示します display(df)  def func_row_check(row):     &quot;&quot;&quot;     列間を比較する      引数:         row[&#39;col1&#39;]: 比較したい列名 col1         row[&#39;col2&#39;]: 比較したいもう一つの列名 col2      Returns:         1 : 一致         9 : 不一致     &quot;&quot;&quot;     if row[&#39;記録 列A&#39;] == row[&#39;報告 列B&#39;]:         return 1     else:         return 9  df[&#39;結果&#39;] = df.apply(func_row_check, axis = 1)  display(df)   カテゴリ毎に人数出して、整形する  1 2 3 4 5 6 cat = df[col4].value_counts() cat = pd.DataFrame(cat) cat = cat.rename_axis(col4) cat.rename(columns={col4: &#39;人数&#39;}, inplace = True)  display(cat)     カテゴリ集計を円グラフにする  1 2 3 4 5 6 7 8 9 10 11 tot = cat.sum() print(tot) sizes = cat[&#39;人数&#39;] labels = cat.index.tolist() fix1, ax1 = plt.subplots() colors = sns.color_palette(&#39;pastel&#39;)[0:9] ax1.pie(sizes, labels=labels, autopct=&#39;%1.1f%%&#39;, startangle=0, colors=colors)  ax1.axis(&#39;equal&#39;) ax1.set_title(&#39;申し込み者属性&#39;, pad=4, fontsize=12, color=&#39;black&#39;) plt.show()   SPSS データの読み取り　カテゴリカルデータでデータフレームを作成 SPSS データは、ラベル名付きとラベル名なし（数値）の二種類をシートを分割して表示している  df = pd.read_spss(&#39;SPSSデータ20230405.sav&#39;, usecols=None, convert_categoricals=True)  SQL here documens  query = &quot;&quot;&quot;     SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;定年年齢&quot;, &quot;継続雇用制度&quot;,&quot;労働者総数&quot;,&quot;労働者総数レンジ&quot;,              &quot;継続雇用-希望者最低年齢&quot;, &quot;継続雇用-基準最高年齢&quot;, &quot;60〜64歳&quot;, &quot;65〜69歳&quot;, &quot;70歳以上&quot;,              &quot;都道府県名&quot;, &quot;都道府県番号&quot;,&quot;産業大分類名&quot;,&quot;産業大分類コード&quot;,&quot;事業具体的内容&quot;     FROM   r4_61_235875by137_tab     WHERE  &quot;適用事業所番号&quot;      IN (             &#39;07040018408&#39;,         &#39;38046133551&#39;,         &#39;19041009509&#39;,         &#39;24031041347&#39;,         &#39;28050009587&#39;,         &#39;03010054500&#39;,         &#39;23090023395&#39;,         &#39;35030028271&#39;,         &#39;47020004572&#39;,         &#39;45032017649&#39;,         &#39;20040019386&#39;,         &#39;41061002192&#39;,         &#39;20040026435&#39;,         &#39;26071017321&#39;,         &#39;23066143807&#39;,         &#39;23044415753&#39;,         &#39;17010005343&#39;,         &#39;17020009844&#39;,         &#39;08011007115&#39;,         &#39;14015254513&#39;,         &#39;13086280459&#39;         )  &quot;&quot;&quot;  #dbname = &#39;r4_61_235875by137_0118r5.db&#39; conn = sqlite3.connect(dbname) cur = conn.cursor()  # dbをpandasで読み出す。 # WHERE で条件に合致した要素のみを読み込み、それをDataFrame に格納する df1 = pd.read_sql(query, conn)  docker グループにユーザ(user)を追加する     $ docker ps Got permission denied while trying to connect to the Docker daemon  socket at unix:///var/run/docker.sock:  Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json:  dial unix /var/run/docker.sock: connect: permission denied   user@KENKYU01:~$ sudo gpasswd -a user sudo  [sudo] password for user: Adding user user to group sudo  docker conainer  からminimal thema でPublish(bundle exec jekyll server -H 0.0.0.0)する  $ winpty docker run --rm -it --name docker_jekyll     -v /$PWD/_config.yml://work/_config.yml     -v /$PWD/index.html://work/index.html     -v /$PWD/_data/://work/_data/     -v /$PWD/_posts/://work/_posts/     -v /$PWD/_site/://work/_site/     -v /$PWD/images/://work/images/     -v /$PWD/assets/://work/assets/     -p 4000:4000     -w //work     docker_jekyll     bundle exec jekyll serve -H 0.0.0.0  グループの追加ができたことを確認する。ログアウトすること。  user@KENKYU01:~$ id user uid=1000(user) gid=1000(user) groups=1000(user),27(sudo),1001(docker) user@KENKYU01:~$ exit logout  SQL 文　条件追加 and/or/not  format_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,                &#39;法人番号&#39;: &#39;{:.0f}&#39; ,                &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,                &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39; }  query = &quot;&quot;&quot;     SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;法人番号&quot;, &quot;住所&quot;,&quot;定年有無&quot; ,&quot;定年年齢&quot;, &quot;継続雇用-希望者最低年齢&quot;, &quot;労働者総数レンジ&quot;, &quot;労働者総数&quot; ,&quot;産業大分類名&quot;, &quot;都道府県名&quot;     FROM &quot;r3_61_227051by137_tab&quot;     WHERE &quot;定年有無&quot; == 2 OR     &quot;定年年齢&quot; &gt;= 70 OR     &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND     &quot;産業中分類コード&quot; &lt;&gt; 94 AND     &quot;産業中分類コード&quot; &lt;&gt; 97 AND     &quot;産業中分類コード&quot; &lt;&gt; 98   &quot;&quot;&quot;  dbname = dbname conn = sqlite3.connect(dbname) cur = conn.cursor() # dbをpandasで読み出す。 df = pd.read_sql(query, conn) cur.close() conn.close()  ２つのデータフレームをIndexをKeyにmerge する。  Merge するキー列をIndexにするため、df.set_index(‘キー列名’)をする  1 2 3 4 5 6 7 8 9 10 df = df.set_index(&quot;事業所番号&quot;) da = df  df = df.set_index(&quot;事業所番号&quot;) dfb = df   df = pd.merge(dfa, dfb, how = &#39;inner&#39;, on = &#39;事業所番号&#39;) OR df = pd.merge(dfa, dfb, how = &#39;outer&#39;, on = &#39;事業所番号&#39;)">







  <meta property="article:published_time" content="2023-09-07T00:00:00+00:00">





  

  


<link rel="canonical" href="http://0.0.0.0:4000/python_cheat_sheet/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "so-wi.com",
      "url": "http://0.0.0.0:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Python Cheat Sheet Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="./Markdown Python Cheat Sheet_files/main.css">
<link rel="stylesheet" href="./Markdown Python Cheat Sheet_files/all.min.css" as="style" onload="this.onload=null;this.rel=&#39;stylesheet&#39;">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  <style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>

  <body class="layout--splash landing dark-theme">
    <nav class="skip-links">
  <ul>
    <li><a href="http://localhost:4000/python_cheat_sheet/#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="http://localhost:4000/python_cheat_sheet/#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="http://localhost:4000/python_cheat_sheet/#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="http://localhost:4000/" style="">
          Python Cheat Sheet
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button" count="0">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      

<div id="main" role="main">
  <article class="splash" itemscope="" itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Pandas Python 慣用句">
    <meta itemprop="description" content="目次  文字の強調  21人以上にフィルタリングする  データフレームをCSVファイルで書き出すTable1234|左寄せ|真ん中|右寄せ||:-----|:----:|-----:||1-1|1-2|1-3||2-1|2-2|2-3|            左寄せ      真ん中      右寄せ                  1-1      1-2      1-3              2-1      2-2      2-3      枠で囲む123　&lt;div style=&quot;padding: 20px; margin-bottom: 10px; border: 3px solid #DF1452; border-radius: 8px;&quot;&gt;   ここにテキストはいる　&lt;/div&gt;   ここにテキストはいる　border: 3px solid #DF1452; border-radius: 8px;   ここにテキストはいる　border: 3px solid #092CDB; border-radius: 12px;   ここにテキストはいる　 border: 7px dashed #DF8914; border-radius: 5px;   ここにテキストはいる　 border: 3px double #14DF20; border-radius: 5px; border-width: thick;見出し1234567&lt;div style=  &quot;position: relative;  padding: 1rem 2rem;  text-align: center;  border: 3px solid #000;&quot;&gt;ここにテキストはいる&lt;/div&gt;ここにテキストはいる  ここにテキストはいる文字の強調1　`ascending = False`{:style=&quot;background: #ff0044; color: white; font-size: 150%&quot;}150% で白抜き文字、赤背景　ascending = False#f5e964 : 黄色#ff0044 : コバルトブルー12`git@github.com:`{:style=&quot;background: #f5e964; font-size: 120%&quot;} `git@github.com:`{:style=&quot;background: #64f5eb; font-size: 120%&quot;} git@github.com:   git@github.com::::note infoインフォメーションinfoは省略可能です。:::データフレームの各列の列名、ユニーク数、型、NaNの数の一覧表を作成する1234df_overview = pd.DataFrame([[i, len(df[i].unique()), df[i].dtypes, df[i].isnull().sum()]     for i in df.columns], columns=[&#39;Feature&#39;, &#39;Unique Values&#39;, &#39;dtypes&#39;, &#39;NaN&#39;])df_overview21人以上にフィルタリングする123   print(df.shape)   df = df[df[&#39;労働者総数&#39;] &gt;= 21]   print(df.shape)NaNの行を取る123   print(df.shape)   df = df[df[&#39;会社数&#39;].isnull() == False]   print(df.shape)データフレームをCSVファイルで書き出すインデックス値は不要   df.to_csv(&#39;61_法人番号_dup.csv&#39;, encoding=&#39;utf-8&#39;,  index=False)適用事業所番号の列の桁数をチェックする。　最初がゼロの場合、Excel 通してゼロになっている場合があるため 桁数が 10桁のところがあるので、全てを11桁に統一させる 先頭の2桁を抜き出す123456   df[&#39;適用事業所番号&#39;]=df[&#39;適用事業所番号&#39;].astype(str)   df[&#39;length&#39;]=list(map(len,df[&#39;適用事業所番号&#39;]))   df[&#39;length&#39;].value_counts()    s = df[&#39;適用事業所番号&#39;]   df[&#39;適用事業所番号&#39;]=pd.DataFrame(s.str.zfill(11))先頭の2桁を抜き出す　string なので、それをnumeric に変換する  抜き出した都道府県番号が47個あるか確認する。12  df[&#39;都道府県番号&#39;] = df[&#39;適用事業所番号&#39;].str[:2]  df[&#39;都道府県番号&#39;] = pd.to_numeric(df[&#39;都道府県番号&#39;],errors = &#39;coerce&#39; )s.str[2:6]で6桁の申請日のうち、3,4,5,6 を取り出す。　これが mmdd である  df[&#39;日月&#39;] = df[&#39;申請日&#39;].str[2:6]列名 length は不要なので、その列を drop する df = df.drop(columns=[&#39;length&#39;])列名「法人番号」を「会社数」に変更する df.rename(columns={&#39;法人番号&#39;: &#39;会社数&#39;}, inplace = True)列名を指定してデータフレームを再編成する  df = df.loc[:, [&#39;法人番号&#39;, &#39;適用事業所番号&#39;,&#39;法人名&#39;, &#39;住所&#39;, &#39;労働者総数レンジ&#39;, &#39;都道府県名&#39;, &#39;産業大分類名&#39;]]列名「法人名かな」に含まれる全角をなくす  df[&#39;法人名かな&#39;]=df[&#39;法人名かな&#39;].str.replace(&quot;　&quot;, &quot;&quot;)オリジナル６１データに含まれていた列 Unnamed 130 から　139 までを削除する123456789101112df=df.drop(columns=[    &#39;Unnamed: 130&#39;,    &#39;Unnamed: 131&#39;,    &#39;Unnamed: 132&#39;,    &#39;Unnamed: 133&#39;,    &#39;Unnamed: 134&#39;,    &#39;Unnamed: 135&#39;,    &#39;Unnamed: 136&#39;,    &#39;Unnamed: 137&#39;,    &#39;Unnamed: 138&#39;,    &#39;Unnamed: 139&#39;                   ])データフレームの列名を縦にリストする1234pd.options.display.max_rows = 220columns = df.columnscolumns = pd.DataFrame(columns)columns.head(220)抜き出した都道府県番号が47個あるか確認するdf[&#39;都道府県番号&#39;].nunique()法人番号の列内のNaNの総数を出すdf[&#39;法人番号&#39;].isnull().sum()NaN を 9999 で埋める　fillna(9999) で行うdf[&#39;法人番号&#39;]=df[&#39;法人番号&#39;].fillna(9999)申請日の列の型をdatetime 型　dtype(‘&lt;M8[ns]’)にするdf[&#39;申請日&#39;]=pd.to_datetime(df[&#39;申請日&#39;])法人番号で重複排除する123print(df.shape)df.drop_duplicates(subset=&#39;法人番号&#39;, keep=&#39;first&#39;, inplace=True)print(df.shape)法人名の処理する前にオリジナルのデータを取っておくdf[&#39;法人名オリジナル&#39;]=df[&#39;法人名&#39;].copy()法人名についている空白を埋めるdf[&#39;法人名&#39;]=df[&#39;法人名&#39;].str.replace(&quot;　&quot;, &quot;&quot;)SQL DB名：r3_61_227052by137_emp_num_r4.db   SQL Table名： r3_61_227052by137_tab を作成する1234dbname = &#39;r3_61_227052by137_emp_num_r4.db&#39;conn = sqlite3.connect(dbname)cur = conn.cursor()df.to_sql(&#39;r3_61_227052by137_tab&#39;, conn, if_exists=&#39;replace&#39;)SQL ヒアドキュメントサンプル1234567891011121314query = &quot;&quot;&quot;    SELECT             &quot;法人名&quot;,             &quot;都道府県名&quot;,            &quot;労働者総数&quot;,            &quot;産業大分類名&quot;,            &quot;法人番号&quot;    FROM    &quot;r3_61_227052by137_tab&quot;    WHERE   &quot;法人名&quot;     IN      (                &#39;北海道信用金庫&#39;,            &#39;株式会社エスピー工研&#39;            )  &quot;&quot;&quot;SQL ヒアドキュメントメインQuery1234567891011121314151617181920query = &quot;&quot;&quot;    SELECT             &quot;法人名&quot;,             &quot;適用事業所番号&quot;,            &quot;法人番号&quot;,             &quot;住所&quot;,            &quot;定年有無&quot; ,            &quot;定年年齢&quot;,             &quot;継続雇用-希望者最低年齢&quot;,             &quot;労働者総数レンジ&quot;,             &quot;産業大分類名&quot;,             &quot;都道府県名&quot;    FROM    &quot;r3_61_227052by137_tab&quot;    WHERE   &quot;定年有無&quot; == 2 OR            &quot;定年年齢&quot; &gt;= 70 OR            &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND            &quot;産業中分類コード&quot; &lt;&gt; 94 AND            &quot;産業中分類コード&quot; &lt;&gt; 97 AND            &quot;産業中分類コード&quot; &lt;&gt; 98    &quot;&quot;&quot;display df のフォーマットを指定する1234567format_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,               &#39;法人番号&#39;: &#39;{:.0f}&#39;,                &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,               &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,               &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39;              }df.style.format(format_dict)SQL query サンプル123456dbname = dbnameconn = sqlite3.connect(dbname)cur = conn.cursor()df = pd.read_sql(query, conn)cur.close()conn.close()Read EXCEL file ファイル名とシート名とIndexとするカラムを指定する。 EXCELにインデクスがない場合は　index_col=None を指定する12xlsx = pd.ExcelFile(&#39;基準データ2023.xlsx&#39;)df = pd.read_excel(xlsx, &#39;data_2023&#39;, index_col=&#39;idx&#39;, header=0)読み込んだdfからヒートマップを作成123plt.rcParams[&#39;figure.figsize&#39;] = 12, 12sns.heatmap(df, annot=True, cmap=&#39;BuGn&#39;)plt.savefig(&#39;employment1.png&#39;)インデックスJoindf12 = df1.join(df2, rsuffix=&#39;_2&#39;)カラム”mean” の値の大きい順 ascending = False でソートする値の大きい順、日付けの新しい順　ascending = Falsedf = df.sort_values([&quot;mean&quot;], ascending = False)カラム名　産業大分類名で構成比を成型して表示する12345678col_name = &#39;産業大分類名&#39;tab = df[col_name].value_counts()tab = pd.DataFrame(tab)tab = tab.rename_axis(col_name)tab[&#39;構成比&#39;]=(tab[col_name] / tab[col_name].sum())tab.rename(columns={col_name: &#39;会社数&#39;}, inplace = True)format_dict = {&#39;構成比&#39;: &#39;{:.1%}&#39;}display(tab.style.format(format_dict))CSV file read123import codecswith codecs.open(&quot;WA_Fn-UseC_-HR-Employee-Attrition.csv&quot;, mode =&quot;r&quot;, encoding =&quot;utf-8&quot;, errors=&quot;ignore&quot;) as file:    df = pd.read_csv(file, delimiter =&quot;,&quot;, header=0)Count Plot サンプル1234567891011121314151617181920212223242526272829303132import numpy as npimport pandas as pdimport seaborn as sns# matplotlibのグラフをRetinaの高解像度で表示する%config InlineBackend.figure_formats = {&#39;png&#39;, &#39;retina&#39;}# Jupyter Notebookの中で作図した画像を表示させる%matplotlib inline# matplotlib をインポートするimport matplotlib.pyplot as plt# 図のサイズを12inch x 12inch = 864px X 864px にするplt.rcParams[&#39;figure.figsize&#39;] = 12, 12# 日本語タイトルのため、japanizeをインポートするimport japanize_matplotlibplt.rcParams[&#39;font.family&#39;] = &#39;IPAexGothic&#39;# 列を縦にする# plt.xticks(rotation=90)col_name = &#39;YearsAtCompany&#39;sns.countplot(x=col_name, data=df, palette=&#39;hls&#39;)#seaborn countplotを設定し、変数axとしてAnnotationを上書できるようにするax = sns.countplot(x = col_name,                    data = df)# Annotation を設定するfor p in ax.patches:    ax.annotate(format(p.get_height(), &#39;.0f&#39;),                    (p.get_x() + p.get_width() / 2.,                     p.get_height()),                     ha = &#39;center&#39;,                     va = &#39;center&#39;,                     xytext = (0, 9),                     textcoords = &#39;offset points&#39;,                    fontsize = 8,                    color = &#39;blue&#39;)Openpyxl でExcel file のシート名を確認する12345678# ライブラリを読み込むimport openpyxl as xlimport win32com.clientimport osfilename = &#39;61_matching_lisr_winner_1221_v2.xlsx&#39;wb = xl.load_workbook(filename)wb.sheetnamesデータフレーム df, dt を横に結合させるdf = pd.concat([df, dt], axis = 1)都道府県番号；都道府県名を一つの要素としてカラム名「都道府県」部分を、「都道府県番号」と「都道府県名」に分割した新しいデータフレーム「dt」を作成する1234567df[&#39;new&#39;] = df[&#39;都道府県&#39;].str.split(&#39;:&#39;)np_array = df[&#39;new&#39;].valuesnp_list = np_array.tolist()dt = pd.DataFrame(np_list)cols = [&#39;都道府県番号&#39;, &#39;都道府県名&#39;]dt.columns = colsdisplay(dt.head())カラム名「name」をインデクスに変えるdf = df.set_index(&#39;name&#39;)元のインデクス値をインデクスに戻す（リセットする）df = df.reset_index()列間を比較し、その結果を 1\9 で出す1234567891011121314151617181920212223242526272829303132# 必要なモジュールをインポートしますimport numpy as npimport pandas as pd# 演習用のデータフレームを作成します。# ２番目の北海道と宮城県の顧客番号はint型でその他はstr型でデータフレームを作成df = pd.DataFrame({ &#39;社員番号&#39;: [&#39;01285679&#39;, &#39;01340788&#39;, &#39;02123782&#39;, &#39;03541976&#39;, &#39;04297411&#39;, &#39;13299899&#39;, &#39;30144450&#39;, &#39;47339981&#39;],                   &#39;記録 列A&#39;:   [4,3,2,1,4,2,3,8],                   &#39;報告 列B&#39;: [4,3,2,2,4,0,3,8]},                    index=[0, 1, 2, 3, 4, 5, 6,7])# データフレームを表示しますdisplay(df)def func_row_check(row):    &quot;&quot;&quot;    列間を比較する    引数:        row[&#39;col1&#39;]: 比較したい列名 col1        row[&#39;col2&#39;]: 比較したいもう一つの列名 col2    Returns:        1 : 一致        9 : 不一致    &quot;&quot;&quot;    if row[&#39;記録 列A&#39;] == row[&#39;報告 列B&#39;]:        return 1    else:        return 9df[&#39;結果&#39;] = df.apply(func_row_check, axis = 1)display(df)カテゴリ毎に人数出して、整形する123456cat = df[col4].value_counts()cat = pd.DataFrame(cat)cat = cat.rename_axis(col4)cat.rename(columns={col4: &#39;人数&#39;}, inplace = True)display(cat)カテゴリ集計を円グラフにする1234567891011tot = cat.sum()print(tot)sizes = cat[&#39;人数&#39;]labels = cat.index.tolist()fix1, ax1 = plt.subplots()colors = sns.color_palette(&#39;pastel&#39;)[0:9]ax1.pie(sizes, labels=labels, autopct=&#39;%1.1f%%&#39;, startangle=0, colors=colors)ax1.axis(&#39;equal&#39;)ax1.set_title(&#39;申し込み者属性&#39;, pad=4, fontsize=12, color=&#39;black&#39;)plt.show()SPSS データの読み取り　カテゴリカルデータでデータフレームを作成SPSS データは、ラベル名付きとラベル名なし（数値）の二種類をシートを分割して表示しているdf = pd.read_spss(&#39;SPSSデータ20230405.sav&#39;, usecols=None, convert_categoricals=True)SQL here documensquery = &quot;&quot;&quot;    SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;定年年齢&quot;, &quot;継続雇用制度&quot;,&quot;労働者総数&quot;,&quot;労働者総数レンジ&quot;,             &quot;継続雇用-希望者最低年齢&quot;, &quot;継続雇用-基準最高年齢&quot;, &quot;60〜64歳&quot;, &quot;65〜69歳&quot;, &quot;70歳以上&quot;,             &quot;都道府県名&quot;, &quot;都道府県番号&quot;,&quot;産業大分類名&quot;,&quot;産業大分類コード&quot;,&quot;事業具体的内容&quot;    FROM   r4_61_235875by137_tab    WHERE  &quot;適用事業所番号&quot;     IN (            &#39;07040018408&#39;,        &#39;38046133551&#39;,        &#39;19041009509&#39;,        &#39;24031041347&#39;,        &#39;28050009587&#39;,        &#39;03010054500&#39;,        &#39;23090023395&#39;,        &#39;35030028271&#39;,        &#39;47020004572&#39;,        &#39;45032017649&#39;,        &#39;20040019386&#39;,        &#39;41061002192&#39;,        &#39;20040026435&#39;,        &#39;26071017321&#39;,        &#39;23066143807&#39;,        &#39;23044415753&#39;,        &#39;17010005343&#39;,        &#39;17020009844&#39;,        &#39;08011007115&#39;,        &#39;14015254513&#39;,        &#39;13086280459&#39;        ) &quot;&quot;&quot;#dbname = &#39;r4_61_235875by137_0118r5.db&#39;conn = sqlite3.connect(dbname)cur = conn.cursor()# dbをpandasで読み出す。# WHERE で条件に合致した要素のみを読み込み、それをDataFrame に格納するdf1 = pd.read_sql(query, conn)docker グループにユーザ(user)を追加する  $ docker psGot permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json: dial unix /var/run/docker.sock: connect: permission denieduser@KENKYU01:~$ sudo gpasswd -a user sudo[sudo] password for user:Adding user user to group sudodocker conainer  からminimal thema でPublish(bundle exec jekyll server -H 0.0.0.0)する$ winpty docker run --rm -it --name docker_jekyll     -v /$PWD/_config.yml://work/_config.yml     -v /$PWD/index.html://work/index.html     -v /$PWD/_data/://work/_data/     -v /$PWD/_posts/://work/_posts/     -v /$PWD/_site/://work/_site/     -v /$PWD/images/://work/images/     -v /$PWD/assets/://work/assets/     -p 4000:4000     -w //work     docker_jekyll     bundle exec jekyll serve -H 0.0.0.0グループの追加ができたことを確認する。ログアウトすること。user@KENKYU01:~$ id useruid=1000(user) gid=1000(user) groups=1000(user),27(sudo),1001(docker)user@KENKYU01:~$ exitlogoutSQL 文　条件追加 and/or/notformat_dict = { &#39;str%&#39;: &#39;{:.1%}&#39;,               &#39;法人番号&#39;: &#39;{:.0f}&#39; ,               &#39;定年到達者総数-65歳未満&#39;: &#39;{:.0f}&#39;,               &#39;定年退職者数（継続雇用希望なし）-65歳未満&#39;: &#39;{:.0f}&#39;,               &#39;継続雇用者数-65歳未満&#39;: &#39;{:.0f}&#39; }query = &quot;&quot;&quot;    SELECT &quot;法人名&quot;, &quot;適用事業所番号&quot;,&quot;法人番号&quot;, &quot;住所&quot;,&quot;定年有無&quot; ,&quot;定年年齢&quot;, &quot;継続雇用-希望者最低年齢&quot;, &quot;労働者総数レンジ&quot;, &quot;労働者総数&quot; ,&quot;産業大分類名&quot;, &quot;都道府県名&quot;    FROM &quot;r3_61_227051by137_tab&quot;    WHERE &quot;定年有無&quot; == 2 OR    &quot;定年年齢&quot; &gt;= 70 OR    &quot;継続雇用-希望者最低年齢&quot; &gt;= 70 AND    &quot;産業中分類コード&quot; &lt;&gt; 94 AND    &quot;産業中分類コード&quot; &lt;&gt; 97 AND    &quot;産業中分類コード&quot; &lt;&gt; 98  &quot;&quot;&quot;dbname = dbnameconn = sqlite3.connect(dbname)cur = conn.cursor()# dbをpandasで読み出す。df = pd.read_sql(query, conn)cur.close()conn.close()２つのデータフレームをIndexをKeyにmerge する。Merge するキー列をIndexにするため、df.set_index(‘キー列名’)をする12345678910df = df.set_index(&quot;事業所番号&quot;)da = dfdf = df.set_index(&quot;事業所番号&quot;)dfb = dfdf = pd.merge(dfa, dfb, how = &#39;inner&#39;, on = &#39;事業所番号&#39;)ORdf = pd.merge(dfa, dfb, how = &#39;outer&#39;, on = &#39;事業所番号&#39;)">
    <meta itemprop="datePublished" content="2023-09-07T00:00:00+00:00">
    

    <section class="page__content" itemprop="text">
      <p><strong>目次</strong><br></p>
<ol>
  <li><a href="http://localhost:4000/python_cheat_sheet/#%E6%96%87%E5%AD%97%E3%81%AE%E5%BC%B7%E8%AA%BF">文字の強調</a></li>
  <li><a href="http://localhost:4000/python_cheat_sheet/#21%E4%BA%BA%E4%BB%A5%E4%B8%8A%E3%81%AB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B">21人以上にフィルタリングする</a><br></li>
  <li><a href="http://localhost:4000/python_cheat_sheet/#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%82%92csv%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99">データフレームをCSVファイルで書き出す</a><br></li>
</ol>

<h3 id="table">Table<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#table" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="o">|</span><span class="n">左寄せ</span><span class="o">|</span><span class="n">真ん中</span><span class="o">|</span><span class="n">右寄せ</span><span class="o">|</span>
<span class="o">|</span><span class="p">:</span><span class="o">-----|</span><span class="p">:</span><span class="o">----</span><span class="p">:</span><span class="o">|-----</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">|</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">|</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">|</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="o">|</span>
</pre></td></tr></tbody></table></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">左寄せ</th>
      <th style="text-align: center">真ん中</th>
      <th style="text-align: right">右寄せ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1-1</td>
      <td style="text-align: center">1-2</td>
      <td style="text-align: right">1-3</td>
    </tr>
    <tr>
      <td style="text-align: left">2-1</td>
      <td style="text-align: center">2-2</td>
      <td style="text-align: right">2-3</td>
    </tr>
  </tbody>
</table>

<h3 id="枠で囲む">枠で囲む<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%9E%A0%E3%81%A7%E5%9B%B2%E3%82%80" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="err">　</span><span class="o">&lt;</span><span class="n">div</span> <span class="n">style</span><span class="o">=</span><span class="s">"padding: 20px; margin-bottom: 10px; border: 3px solid #DF1452; border-radius: 8px;"</span><span class="o">&gt;</span>
   <span class="n">ここにテキストはいる</span>
<span class="err">　</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<div style="padding: 20px; margin-bottom: 10px; border: 3px solid #DF1452; border-radius: 8px;">
   ここにテキストはいる　border: 3px solid #DF1452; border-radius: 8px;
</div>
<div style="padding: 20px; margin-bottom: 10px; border: 3px solid #092CDB; border-radius: 12px;">
   ここにテキストはいる　border: 3px solid #092CDB; border-radius: 12px;
</div>
<div style="padding: 20px; margin-bottom: 10px; border: 7px dashed #DF8914; border-radius: 5px;">
   ここにテキストはいる　 border: 7px dashed #DF8914; border-radius: 5px;
</div>
<div style="padding: 20px; margin-bottom: 10px; border: 3px double #14DF20; border-radius: 5px; border-width: thick;">
   ここにテキストはいる　 border: 3px double #14DF20; border-radius: 5px; border-width: thick;
</div>

<h3 id="見出し">見出し<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E8%A6%8B%E5%87%BA%E3%81%97" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">&lt;</span><span class="n">div</span> <span class="n">style</span><span class="o">=</span>
  <span class="s">"position: relative;
  padding: 1rem 2rem;
  text-align: center;
  border: 3px solid #000;"</span><span class="o">&gt;</span>
<span class="n">ここにテキストはいる</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<div style="position: relative;
  padding: 1rem 2rem;
  text-align: center;
  border: 3px solid #000;">
ここにテキストはいる
</div>

<div style="font-size: 15px;
  font-size: 1.5rem;
  position: absolute;
  top: -24px;
  left: -3px;
  height: 24px;
  padding: 0 1em;
  content: &#39;POINT&#39;;
  color: #fff;
  background: #000;">
  ここにテキストはいる
</div>

<h3 id="文字の強調">文字の強調<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%96%87%E5%AD%97%E3%81%AE%E5%BC%B7%E8%AA%BF" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="err">　</span><span class="sb">`ascending = False`</span><span class="p">{:</span><span class="n">style</span><span class="o">=</span><span class="s">"background: #ff0044; color: white; font-size: 150%"</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>150% で白抜き文字、赤背景</p>

<p>　<code style="background: #ff0044; color: white; font-size: 150%" class="language-plaintext highlighter-rouge">ascending = False</code></p>

<p>#f5e964 : 黄色
#ff0044 : コバルトブルー</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="sb">`git@github.com:`</span><span class="p">{:</span><span class="n">style</span><span class="o">=</span><span class="s">"background: #f5e964; font-size: 120%"</span><span class="p">}</span> 
<span class="sb">`git@github.com:`</span><span class="p">{:</span><span class="n">style</span><span class="o">=</span><span class="s">"background: #64f5eb; font-size: 120%"</span><span class="p">}</span> 
</pre></td></tr></tbody></table></code></pre></figure>

<p><code style="background: #f5e964; font-size: 120%" class="language-plaintext highlighter-rouge">git@github.com:</code> <br>
  <code style="background: #64f5eb; font-size: 120%" class="language-plaintext highlighter-rouge">git@github.com:</code></p>

<p>:::note info
インフォメーション
infoは省略可能です。
:::</p>

<h3 id="データフレームの各列の列名ユニーク数型nanの数の一覧表を作成する">データフレームの各列の列名、ユニーク数、型、NaNの数の一覧表を作成する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E5%90%84%E5%88%97%E3%81%AE%E5%88%97%E5%90%8D%E3%83%A6%E3%83%8B%E3%83%BC%E3%82%AF%E6%95%B0%E5%9E%8Bnan%E3%81%AE%E6%95%B0%E3%81%AE%E4%B8%80%E8%A6%A7%E8%A1%A8%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="n">df_overview</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">unique</span><span class="p">()),</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()]</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'Feature'</span><span class="p">,</span> <span class="s">'Unique Values'</span><span class="p">,</span> <span class="s">'dtypes'</span><span class="p">,</span> <span class="s">'NaN'</span><span class="p">])</span>

<span class="n">df_overview</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="21人以上にフィルタリングする">21人以上にフィルタリングする<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#21%E4%BA%BA%E4%BB%A5%E4%B8%8A%E3%81%AB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>   <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
   <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'労働者総数'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="p">]</span>
   <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="nanの行を取る">NaNの行を取る<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#nan%E3%81%AE%E8%A1%8C%E3%82%92%E5%8F%96%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>   <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
   <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'会社数'</span><span class="p">].</span><span class="n">isnull</span><span class="p">()</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span>
   <span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="データフレームをcsvファイルで書き出す">データフレームをCSVファイルで書き出す<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%82%92csv%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>インデックス値は不要</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">   <span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'61_法人番号_dup.csv'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">,</span>  <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></figure>

<h3 id="適用事業所番号の列の桁数をチェックする">適用事業所番号の列の桁数をチェックする。　<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E9%81%A9%E7%94%A8%E4%BA%8B%E6%A5%AD%E6%89%80%E7%95%AA%E5%8F%B7%E3%81%AE%E5%88%97%E3%81%AE%E6%A1%81%E6%95%B0%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>最初がゼロの場合、Excel 通してゼロになっている場合があるため 桁数が 10桁のところがあるので、全てを11桁に統一させる 先頭の2桁を抜き出す</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre>   <span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
   <span class="n">df</span><span class="p">[</span><span class="s">'length'</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">]))</span>
   <span class="n">df</span><span class="p">[</span><span class="s">'length'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
 
   <span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">]</span>
   <span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="先頭の2桁を抜き出す">先頭の2桁を抜き出す　<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%85%88%E9%A0%AD%E3%81%AE2%E6%A1%81%E3%82%92%E6%8A%9C%E3%81%8D%E5%87%BA%E3%81%99" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>string なので、それをnumeric に変換する  抜き出した都道府県番号が47個あるか確認する。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>  <span class="n">df</span><span class="p">[</span><span class="s">'都道府県番号'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'適用事業所番号'</span><span class="p">].</span><span class="nb">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">df</span><span class="p">[</span><span class="s">'都道府県番号'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'都道府県番号'</span><span class="p">],</span><span class="n">errors</span> <span class="o">=</span> <span class="s">'coerce'</span> <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="sstr26で6桁の申請日のうち3456-を取り出すこれが-mmdd-である">s.str[2:6]で6桁の申請日のうち、3,4,5,6 を取り出す。　これが mmdd である<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sstr26%E3%81%A76%E6%A1%81%E3%81%AE%E7%94%B3%E8%AB%8B%E6%97%A5%E3%81%AE%E3%81%86%E3%81%A13456-%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99%E3%81%93%E3%82%8C%E3%81%8C-mmdd-%E3%81%A7%E3%81%82%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="n">df</span><span class="p">[</span><span class="s">'日月'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'申請日'</span><span class="p">].</span><span class="nb">str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span></code></pre></figure>

<h3 id="列名-length-は不要なのでその列を-drop-する">列名 length は不要なので、その列を drop する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%88%97%E5%90%8D-length-%E3%81%AF%E4%B8%8D%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%A7%E3%81%9D%E3%81%AE%E5%88%97%E3%82%92-drop-%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'length'</span><span class="p">])</span></code></pre></figure>

<h3 id="列名法人番号を会社数に変更する">列名「法人番号」を「会社数」に変更する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%88%97%E5%90%8D%E6%B3%95%E4%BA%BA%E7%95%AA%E5%8F%B7%E3%82%92%E4%BC%9A%E7%A4%BE%E6%95%B0%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="n">df</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'法人番号'</span><span class="p">:</span> <span class="s">'会社数'</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span></code></pre></figure>

<h3 id="列名を指定してデータフレームを再編成する">列名を指定してデータフレームを再編成する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%88%97%E5%90%8D%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%82%92%E5%86%8D%E7%B7%A8%E6%88%90%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s">'法人番号'</span><span class="p">,</span> <span class="s">'適用事業所番号'</span><span class="p">,</span><span class="s">'法人名'</span><span class="p">,</span> <span class="s">'住所'</span><span class="p">,</span> <span class="s">'労働者総数レンジ'</span><span class="p">,</span> <span class="s">'都道府県名'</span><span class="p">,</span> <span class="s">'産業大分類名'</span><span class="p">]]</span></code></pre></figure>

<h3 id="列名法人名かなに含まれる全角をなくす">列名「法人名かな」に含まれる全角をなくす<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%88%97%E5%90%8D%E6%B3%95%E4%BA%BA%E5%90%8D%E3%81%8B%E3%81%AA%E3%81%AB%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E5%85%A8%E8%A7%92%E3%82%92%E3%81%AA%E3%81%8F%E3%81%99" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="n">df</span><span class="p">[</span><span class="s">'法人名かな'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'法人名かな'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"　"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span></code></pre></figure>

<h3 id="オリジナル６１データに含まれていた列-unnamed-130-から139-までを削除する">オリジナル６１データに含まれていた列 Unnamed 130 から　139 までを削除する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%8A%E3%83%AB%EF%BC%96%EF%BC%91%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AB%E5%90%AB%E3%81%BE%E3%82%8C%E3%81%A6%E3%81%84%E3%81%9F%E5%88%97-unnamed-130-%E3%81%8B%E3%82%89139-%E3%81%BE%E3%81%A7%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'Unnamed: 130'</span><span class="p">,</span>
    <span class="s">'Unnamed: 131'</span><span class="p">,</span>
    <span class="s">'Unnamed: 132'</span><span class="p">,</span>
    <span class="s">'Unnamed: 133'</span><span class="p">,</span>
    <span class="s">'Unnamed: 134'</span><span class="p">,</span>
    <span class="s">'Unnamed: 135'</span><span class="p">,</span>
    <span class="s">'Unnamed: 136'</span><span class="p">,</span>
    <span class="s">'Unnamed: 137'</span><span class="p">,</span>
    <span class="s">'Unnamed: 138'</span><span class="p">,</span>
    <span class="s">'Unnamed: 139'</span>
                   <span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="データフレームの列名を縦にリストする">データフレームの列名を縦にリストする<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E5%88%97%E5%90%8D%E3%82%92%E7%B8%A6%E3%81%AB%E3%83%AA%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="n">pd</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">220</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<span class="n">columns</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">220</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="抜き出した都道府県番号が47個あるか確認する">抜き出した都道府県番号が47個あるか確認する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%8A%9C%E3%81%8D%E5%87%BA%E3%81%97%E3%81%9F%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E7%95%AA%E5%8F%B7%E3%81%8C47%E5%80%8B%E3%81%82%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'都道府県番号'</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span></code></pre></figure>

<h3 id="法人番号の列内のnanの総数を出す">法人番号の列内のNaNの総数を出す<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%B3%95%E4%BA%BA%E7%95%AA%E5%8F%B7%E3%81%AE%E5%88%97%E5%86%85%E3%81%AEnan%E3%81%AE%E7%B7%8F%E6%95%B0%E3%82%92%E5%87%BA%E3%81%99" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'法人番号'</span><span class="p">].</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span></code></pre></figure>

<h3 id="nan-を-9999-で埋めるfillna9999-で行う">NaN を 9999 で埋める　fillna(9999) で行う<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#nan-%E3%82%92-9999-%E3%81%A7%E5%9F%8B%E3%82%81%E3%82%8Bfillna9999-%E3%81%A7%E8%A1%8C%E3%81%86" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'法人番号'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'法人番号'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span></code></pre></figure>

<h3 id="申請日の列の型をdatetime-型dtypem8nsにする">申請日の列の型をdatetime 型　dtype(‘&lt;M8[ns]’)にする<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E7%94%B3%E8%AB%8B%E6%97%A5%E3%81%AE%E5%88%97%E3%81%AE%E5%9E%8B%E3%82%92datetime-%E5%9E%8Bdtypem8ns%E3%81%AB%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'申請日'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'申請日'</span><span class="p">])</span></code></pre></figure>

<h3 id="法人番号で重複排除する">法人番号で重複排除する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%B3%95%E4%BA%BA%E7%95%AA%E5%8F%B7%E3%81%A7%E9%87%8D%E8%A4%87%E6%8E%92%E9%99%A4%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s">'法人番号'</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s">'first'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="法人名の処理する前にオリジナルのデータを取っておく">法人名の処理する前にオリジナルのデータを取っておく<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%B3%95%E4%BA%BA%E5%90%8D%E3%81%AE%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B%E5%89%8D%E3%81%AB%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%8A%E3%83%AB%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8F" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'法人名オリジナル'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'法人名'</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span></code></pre></figure>

<h3 id="法人名についている空白を埋める">法人名についている空白を埋める<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E6%B3%95%E4%BA%BA%E5%90%8D%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%84%E3%82%8B%E7%A9%BA%E7%99%BD%E3%82%92%E5%9F%8B%E3%82%81%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span><span class="p">[</span><span class="s">'法人名'</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s">'法人名'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"　"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span></code></pre></figure>

<h3 id="sql-db名r3_61_227052by137_emp_num_r4db---sql-table名-r3_61_227052by137_tab-を作成する">SQL DB名：r3_61_227052by137_emp_num_r4.db  <br> SQL Table名： r3_61_227052by137_tab を作成する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-db%E5%90%8Dr3_61_227052by137_emp_num_r4db---sql-table%E5%90%8D-r3_61_227052by137_tab-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="n">dbname</span> <span class="o">=</span> <span class="s">'r3_61_227052by137_emp_num_r4.db'</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s">'r3_61_227052by137_tab'</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s">'replace'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="sql-ヒアドキュメントサンプル">SQL ヒアドキュメントサンプル<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-%E3%83%92%E3%82%A2%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="n">query</span> <span class="o">=</span> <span class="nv">"</span><span class="se">""</span><span class="nv">
    SELECT 
            "</span><span class="err">法人名</span><span class="nv">", 
            "</span><span class="err">都道府県名</span><span class="nv">",
            "</span><span class="err">労働者総数</span><span class="nv">",
            "</span><span class="err">産業大分類名</span><span class="nv">",
            "</span><span class="err">法人番号</span><span class="nv">"
    FROM    "</span><span class="n">r3_61_227052by137_tab</span><span class="nv">"
    WHERE   "</span><span class="err">法人名</span><span class="nv">" 
    IN      (    
            '北海道信用金庫',
            '株式会社エスピー工研'
            )
  </span><span class="se">""</span><span class="nv">"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="sql-ヒアドキュメントメインquery">SQL ヒアドキュメントメインQuery<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-%E3%83%92%E3%82%A2%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%83%A1%E3%82%A4%E3%83%B3query" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="n">query</span> <span class="o">=</span> <span class="nv">"</span><span class="se">""</span><span class="nv">
    SELECT 
            "</span><span class="err">法人名</span><span class="nv">", 
            "</span><span class="err">適用事業所番号</span><span class="nv">",
            "</span><span class="err">法人番号</span><span class="nv">", 
            "</span><span class="err">住所</span><span class="nv">",
            "</span><span class="err">定年有無</span><span class="nv">" ,
            "</span><span class="err">定年年齢</span><span class="nv">", 
            "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">希望者最低年齢</span><span class="nv">", 
            "</span><span class="err">労働者総数レンジ</span><span class="nv">", 
            "</span><span class="err">産業大分類名</span><span class="nv">", 
            "</span><span class="err">都道府県名</span><span class="nv">"
    FROM    "</span><span class="n">r3_61_227052by137_tab</span><span class="nv">"
    WHERE   "</span><span class="err">定年有無</span><span class="nv">" == 2 OR
            "</span><span class="err">定年年齢</span><span class="nv">" &gt;= 70 OR
            "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">希望者最低年齢</span><span class="nv">" &gt;= 70 AND
            "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 94 AND
            "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 97 AND
            "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 98  
  </span><span class="se">""</span><span class="nv">"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="display-df-のフォーマットを指定する">display df のフォーマットを指定する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#display-df-%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">format_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'str%'</span><span class="p">:</span> <span class="s">'{:.1%}'</span><span class="p">,</span>
               <span class="s">'法人番号'</span><span class="p">:</span> <span class="s">'{:.0f}'</span><span class="p">,</span> 
               <span class="s">'定年到達者総数-65歳未満'</span><span class="p">:</span> <span class="s">'{:.0f}'</span><span class="p">,</span>
               <span class="s">'定年退職者数（継続雇用希望なし）-65歳未満'</span><span class="p">:</span> <span class="s">'{:.0f}'</span><span class="p">,</span>
               <span class="s">'継続雇用者数-65歳未満'</span><span class="p">:</span> <span class="s">'{:.0f}'</span>
              <span class="p">}</span>
<span class="n">df</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">format_dict</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="sql-query-サンプル">SQL query サンプル<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-query-%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="k">cursor</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">cur</span><span class="p">.</span><span class="k">close</span><span class="p">()</span>
<span class="n">conn</span><span class="p">.</span><span class="k">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="read-excel-file-ファイル名とシート名とindexとするカラムを指定する-excelにインデクスがない場合はindex_colnone-を指定する">Read EXCEL file ファイル名とシート名とIndexとするカラムを指定する。 EXCELにインデクスがない場合は　<code class="language-plaintext highlighter-rouge">index_col=None</code> を指定する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#read-excel-file-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%81%A8%E3%82%B7%E3%83%BC%E3%83%88%E5%90%8D%E3%81%A8index%E3%81%A8%E3%81%99%E3%82%8B%E3%82%AB%E3%83%A9%E3%83%A0%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B-excel%E3%81%AB%E3%82%A4%E3%83%B3%E3%83%87%E3%82%AF%E3%82%B9%E3%81%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AFindex_colnone-%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="n">xlsx</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s">'基準データ2023.xlsx'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xlsx</span><span class="p">,</span> <span class="s">'data_2023'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'idx'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="読み込んだdfからヒートマップを作成">読み込んだdfからヒートマップを作成<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A0df%E3%81%8B%E3%82%89%E3%83%92%E3%83%BC%E3%83%88%E3%83%9E%E3%83%83%E3%83%97%E3%82%92%E4%BD%9C%E6%88%90" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span>
<span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'BuGn'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'employment1.png'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="インデックスjoin">インデックスJoin<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9join" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df12</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s">'_2'</span><span class="p">)</span></code></pre></figure>

<h3 id="カラムmean-の値の大きい順-ascending--false-でソートする">カラム”mean” の値の大きい順 ascending = False でソートする<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AB%E3%83%A9%E3%83%A0mean-%E3%81%AE%E5%80%A4%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%84%E9%A0%86-ascending--false-%E3%81%A7%E3%82%BD%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<p>値の大きい順、日付けの新しい順　<code style="background: #ff0044; color: white; font-size: 180%" class="language-plaintext highlighter-rouge">ascending = False</code></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s">"mean"</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span></code></pre></figure>

<h3 id="カラム名産業大分類名で構成比を成型して表示する">カラム名　産業大分類名で構成比を成型して表示する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AB%E3%83%A9%E3%83%A0%E5%90%8D%E7%94%A3%E6%A5%AD%E5%A4%A7%E5%88%86%E9%A1%9E%E5%90%8D%E3%81%A7%E6%A7%8B%E6%88%90%E6%AF%94%E3%82%92%E6%88%90%E5%9E%8B%E3%81%97%E3%81%A6%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="n">col_name</span> <span class="o">=</span> <span class="s">'産業大分類名'</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
<span class="n">tab</span><span class="p">[</span><span class="s">'構成比'</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">/</span> <span class="n">tab</span><span class="p">[</span><span class="n">col_name</span><span class="p">].</span><span class="nb">sum</span><span class="p">())</span>
<span class="n">tab</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col_name</span><span class="p">:</span> <span class="s">'会社数'</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">format_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'構成比'</span><span class="p">:</span> <span class="s">'{:.1%}'</span><span class="p">}</span>
<span class="n">display</span><span class="p">(</span><span class="n">tab</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">format_dict</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="csv-file-read">CSV file read<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#csv-file-read" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">codecs</span>
<span class="k">with</span> <span class="n">codecs</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"WA_Fn-UseC_-HR-Employee-Attrition.csv"</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span><span class="s">"r"</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">"ignore"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span><span class="s">","</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="count-plot-サンプル">Count Plot サンプル<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#count-plot-%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="c1"># matplotlibのグラフをRetinaの高解像度で表示する
</span><span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="p">.</span><span class="n">figure_formats</span> <span class="o">=</span> <span class="p">{</span><span class="s">'png'</span><span class="p">,</span> <span class="s">'retina'</span><span class="p">}</span>
<span class="c1"># Jupyter Notebookの中で作図した画像を表示させる
</span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1"># matplotlib をインポートする
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1"># 図のサイズを12inch x 12inch = 864px X 864px にする
</span><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span>
<span class="c1"># 日本語タイトルのため、japanizeをインポートする
</span><span class="kn">import</span> <span class="nn">japanize_matplotlib</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'font.family'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'IPAexGothic'</span>
<span class="c1"># 列を縦にする
# plt.xticks(rotation=90)
</span><span class="n">col_name</span> <span class="o">=</span> <span class="s">'YearsAtCompany'</span>
<span class="n">sns</span><span class="p">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">col_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">'hls'</span><span class="p">)</span>
<span class="c1">#seaborn countplotを設定し、変数axとしてAnnotationを上書できるようにする
</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">col_name</span><span class="p">,</span> 
                   <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span>
<span class="c1"># Annotation を設定する
</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">get_height</span><span class="p">(),</span> <span class="s">'.0f'</span><span class="p">),</span> 
                   <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> 
                    <span class="n">p</span><span class="p">.</span><span class="n">get_height</span><span class="p">()),</span> 
                    <span class="n">ha</span> <span class="o">=</span> <span class="s">'center'</span><span class="p">,</span> 
                    <span class="n">va</span> <span class="o">=</span> <span class="s">'center'</span><span class="p">,</span> 
                    <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> 
                    <span class="n">textcoords</span> <span class="o">=</span> <span class="s">'offset points'</span><span class="p">,</span>
                    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p><img src="./Markdown Python Cheat Sheet_files/countplot1.png" alt="countplot"><br></p>

<h3 id="openpyxl-でexcel-file-のシート名を確認する">Openpyxl でExcel file のシート名を確認する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#openpyxl-%E3%81%A7excel-file-%E3%81%AE%E3%82%B7%E3%83%BC%E3%83%88%E5%90%8D%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="c1"># ライブラリを読み込む
</span><span class="kn">import</span> <span class="nn">openpyxl</span> <span class="k">as</span> <span class="n">xl</span>
<span class="kn">import</span> <span class="nn">win32com.client</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'61_matching_lisr_winner_1221_v2.xlsx'</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">xl</span><span class="p">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">wb</span><span class="p">.</span><span class="n">sheetnames</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="データフレーム-df-dt-を横に結合させる">データフレーム df, dt を横に結合させる<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0-df-dt-%E3%82%92%E6%A8%AA%E3%81%AB%E7%B5%90%E5%90%88%E3%81%95%E3%81%9B%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">dt</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<h3 id="都道府県番号都道府県名を一つの要素としてカラム名都道府県部分を都道府県番号と都道府県名に分割した新しいデータフレームdtを作成する">都道府県番号；都道府県名を一つの要素としてカラム名「都道府県」部分を、<br>「都道府県番号」と「都道府県名」に分割した新しいデータフレーム「dt」を作成する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E7%95%AA%E5%8F%B7%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E5%90%8D%E3%82%92%E4%B8%80%E3%81%A4%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%A8%E3%81%97%E3%81%A6%E3%82%AB%E3%83%A9%E3%83%A0%E5%90%8D%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E9%83%A8%E5%88%86%E3%82%92%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E7%95%AA%E5%8F%B7%E3%81%A8%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E5%90%8D%E3%81%AB%E5%88%86%E5%89%B2%E3%81%97%E3%81%9F%E6%96%B0%E3%81%97%E3%81%84%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0dt%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">df</span><span class="p">[</span><span class="s">'new'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'都道府県'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)</span>
<span class="n">np_array</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'new'</span><span class="p">].</span><span class="n">values</span>
<span class="n">np_list</span> <span class="o">=</span> <span class="n">np_array</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np_list</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'都道府県番号'</span><span class="p">,</span> <span class="s">'都道府県名'</span><span class="p">]</span>
<span class="n">dt</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
<span class="n">display</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="カラム名nameをインデクスに変える">カラム名「name」をインデクスに変える<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AB%E3%83%A9%E3%83%A0%E5%90%8Dname%E3%82%92%E3%82%A4%E3%83%B3%E3%83%87%E3%82%AF%E3%82%B9%E3%81%AB%E5%A4%89%E3%81%88%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span></code></pre></figure>

<h3 id="元のインデクス値をインデクスに戻すリセットする">元のインデクス値をインデクスに戻す（リセットする）<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%85%83%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%82%AF%E3%82%B9%E5%80%A4%E3%82%92%E3%82%A4%E3%83%B3%E3%83%87%E3%82%AF%E3%82%B9%E3%81%AB%E6%88%BB%E3%81%99%E3%83%AA%E3%82%BB%E3%83%83%E3%83%88%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span></code></pre></figure>

<h3 id="列間を比較しその結果を-19-で出す">列間を比較し、その結果を 1\9 で出す<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E5%88%97%E9%96%93%E3%82%92%E6%AF%94%E8%BC%83%E3%81%97%E3%81%9D%E3%81%AE%E7%B5%90%E6%9E%9C%E3%82%92-19-%E3%81%A7%E5%87%BA%E3%81%99" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="c1"># 必要なモジュールをインポートします
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="c1"># 演習用のデータフレームを作成します。
# ２番目の北海道と宮城県の顧客番号はint型でその他はstr型でデータフレームを作成
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s">'社員番号'</span><span class="p">:</span> <span class="p">[</span><span class="s">'01285679'</span><span class="p">,</span> <span class="s">'01340788'</span><span class="p">,</span> <span class="s">'02123782'</span><span class="p">,</span> <span class="s">'03541976'</span><span class="p">,</span> <span class="s">'04297411'</span><span class="p">,</span> <span class="s">'13299899'</span><span class="p">,</span> <span class="s">'30144450'</span><span class="p">,</span> <span class="s">'47339981'</span><span class="p">],</span>
                   <span class="s">'記録 列A'</span><span class="p">:</span>   <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
                   <span class="s">'報告 列B'</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">]},</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>
<span class="c1"># データフレームを表示します
</span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func_row_check</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="s">"""
    列間を比較する

    引数:
        row['col1']: 比較したい列名 col1
        row['col2']: 比較したいもう一つの列名 col2

    Returns:
        1 : 一致
        9 : 不一致
    """</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">'記録 列A'</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">'報告 列B'</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">9</span>

<span class="n">df</span><span class="p">[</span><span class="s">'結果'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">func_row_check</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="カテゴリ毎に人数出して整形する">カテゴリ毎に人数出して、整形する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E6%AF%8E%E3%81%AB%E4%BA%BA%E6%95%B0%E5%87%BA%E3%81%97%E3%81%A6%E6%95%B4%E5%BD%A2%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="n">cat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col4</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">cat</span><span class="p">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">col4</span><span class="p">)</span>
<span class="n">cat</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col4</span><span class="p">:</span> <span class="s">'人数'</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p><img src="./Markdown Python Cheat Sheet_files/str_num1.png" alt="str_number"><br></p>

<h3 id="カテゴリ集計を円グラフにする">カテゴリ集計を円グラフにする<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E9%9B%86%E8%A8%88%E3%82%92%E5%86%86%E3%82%B0%E3%83%A9%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="n">tot</span> <span class="o">=</span> <span class="n">cat</span><span class="p">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">tot</span><span class="p">)</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s">'人数'</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">cat</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">fix1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s">'pastel'</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s">'%1.1f%%'</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>

<span class="n">ax1</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'申し込み者属性'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="spss-データの読み取りカテゴリカルデータでデータフレームを作成">SPSS データの読み取り　カテゴリカルデータでデータフレームを作成<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#spss-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%AB%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%82%92%E4%BD%9C%E6%88%90" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>
<p>SPSS データは、ラベル名付きとラベル名なし（数値）の二種類をシートを分割して表示している</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_spss</span><span class="p">(</span><span class="s">'SPSSデータ20230405.sav'</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">convert_categoricals</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<h3 id="sql-here-documens">SQL here documens<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-here-documens" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">query</span> <span class="o">=</span> <span class="nv">"</span><span class="se">""</span><span class="nv">
    SELECT "</span><span class="err">法人名</span><span class="nv">", "</span><span class="err">適用事業所番号</span><span class="nv">","</span><span class="err">定年年齢</span><span class="nv">", "</span><span class="err">継続雇用制度</span><span class="nv">","</span><span class="err">労働者総数</span><span class="nv">","</span><span class="err">労働者総数レンジ</span><span class="nv">", 
            "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">希望者最低年齢</span><span class="nv">", "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">基準最高年齢</span><span class="nv">", "</span><span class="mi">60</span><span class="err">〜</span><span class="mi">64</span><span class="err">歳</span><span class="nv">", "</span><span class="mi">65</span><span class="err">〜</span><span class="mi">69</span><span class="err">歳</span><span class="nv">", "</span><span class="mi">70</span><span class="err">歳以上</span><span class="nv">", 
            "</span><span class="err">都道府県名</span><span class="nv">", "</span><span class="err">都道府県番号</span><span class="nv">","</span><span class="err">産業大分類名</span><span class="nv">","</span><span class="err">産業大分類コード</span><span class="nv">","</span><span class="err">事業具体的内容</span><span class="nv">"
    FROM   r4_61_235875by137_tab
    WHERE  "</span><span class="err">適用事業所番号</span><span class="nv">" 
    IN (    
        '07040018408',
        '38046133551',
        '19041009509',
        '24031041347',
        '28050009587',
        '03010054500',
        '23090023395',
        '35030028271',
        '47020004572',
        '45032017649',
        '20040019386',
        '41061002192',
        '20040026435',
        '26071017321',
        '23066143807',
        '23044415753',
        '17010005343',
        '17020009844',
        '08011007115',
        '14015254513',
        '13086280459'
        )
 </span><span class="se">""</span><span class="nv">"</span>

<span class="o">#</span><span class="n">dbname</span> <span class="o">=</span> <span class="s1">'r4_61_235875by137_0118r5.db'</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="k">cursor</span><span class="p">()</span>

<span class="o">#</span> <span class="n">db</span><span class="err">を</span><span class="n">pandas</span><span class="err">で読み出す。</span>
<span class="o">#</span> <span class="k">WHERE</span> <span class="err">で条件に合致した要素のみを読み込み、それを</span><span class="n">DataFrame</span> <span class="err">に格納する</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span></code></pre></figure>

<h3 id="docker-グループにユーザuserを追加する">docker グループにユーザ(user)を追加する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#docker-%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AB%E3%83%A6%E3%83%BC%E3%82%B6user%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<blockquote>
  <p>$ docker ps<br>
Got permission denied while trying to connect to the Docker daemon 
socket at unix:///var/run/docker.sock: 
Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json: 
dial unix /var/run/docker.sock: connect: permission denied</p>
</blockquote>

<figure class="highlight"><pre><code class="language-vb" data-lang="vb"><span class="n">user@KENKYU01</span><span class="p">:</span><span class="err">~$</span> <span class="n">sudo</span> <span class="n">gpasswd</span> <span class="o">-</span><span class="n">a</span> <span class="n">user</span> <span class="n">sudo</span>

<span class="err">[</span><span class="n">sudo</span><span class="err">]</span> <span class="n">password</span> <span class="n">for</span> <span class="n">user</span><span class="p">:</span>
<span class="n">Adding</span> <span class="n">user</span> <span class="n">user</span> <span class="n">to</span> <span class="n">group</span> <span class="n">sudo</span></code></pre></figure>

<h3 id="docker-conainer--からminimal-thema-でpublishbundle-exec-jekyll-server--h-0000する">docker conainer  からminimal thema でPublish(bundle exec jekyll server -H 0.0.0.0)する<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#docker-conainer--%E3%81%8B%E3%82%89minimal-thema-%E3%81%A7publishbundle-exec-jekyll-server--h-0000%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-vb" data-lang="vb"><span class="err">$</span> <span class="n">winpty</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">name</span> <span class="n">docker_jekyll</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">_config</span><span class="p">.</span><span class="n">yml</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">_config</span><span class="p">.</span><span class="n">yml</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">html</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">html</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">_data</span><span class="o">/</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">_data</span><span class="o">/</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">_posts</span><span class="o">/</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">_posts</span><span class="o">/</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">_site</span><span class="o">/</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">_site</span><span class="o">/</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">images</span><span class="o">/</span>     <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="err">$</span><span class="n">PWD</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="p">:</span><span class="o">//</span><span class="n">work</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span>     <span class="o">-</span><span class="n">p</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">4000</span>     <span class="o">-</span><span class="n">w</span> <span class="o">//</span><span class="n">work</span>     <span class="n">docker_jekyll</span>     <span class="n">bundle</span> <span class="n">exec</span> <span class="n">jekyll</span> <span class="n">serve</span> <span class="o">-</span><span class="n">H</span> <span class="mf">0.0</span><span class="p">.</span><span class="err">0.0</span></code></pre></figure>

<h3 id="グループの追加ができたことを確認するログアウトすること">グループの追加ができたことを確認する。ログアウトすること。<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E8%BF%BD%E5%8A%A0%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%9F%E3%81%93%E3%81%A8%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-vb" data-lang="vb"><span class="n">user@KENKYU01</span><span class="p">:</span><span class="err">~$</span> <span class="n">id</span> <span class="n">user</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">user</span><span class="p">),</span><span class="mi">27</span><span class="p">(</span><span class="n">sudo</span><span class="p">),</span><span class="mi">1001</span><span class="p">(</span><span class="n">docker</span><span class="p">)</span>
<span class="n">user@KENKYU01</span><span class="p">:</span><span class="err">~$</span> <span class="n">exit</span>
<span class="n">logout</span></code></pre></figure>

<h3 id="sql-文条件追加-andornot">SQL 文　条件追加 and/or/not<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#sql-%E6%96%87%E6%9D%A1%E4%BB%B6%E8%BF%BD%E5%8A%A0-andornot" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h3>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">format_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'str%'</span><span class="p">:</span> <span class="s1">'{:.1%}'</span><span class="p">,</span>
               <span class="s1">'法人番号'</span><span class="p">:</span> <span class="s1">'{:.0f}'</span> <span class="p">,</span>
               <span class="s1">'定年到達者総数-65歳未満'</span><span class="p">:</span> <span class="s1">'{:.0f}'</span><span class="p">,</span>
               <span class="s1">'定年退職者数（継続雇用希望なし）-65歳未満'</span><span class="p">:</span> <span class="s1">'{:.0f}'</span><span class="p">,</span>
               <span class="s1">'継続雇用者数-65歳未満'</span><span class="p">:</span> <span class="s1">'{:.0f}'</span> <span class="p">}</span>

<span class="n">query</span> <span class="o">=</span> <span class="nv">"</span><span class="se">""</span><span class="nv">
    SELECT "</span><span class="err">法人名</span><span class="nv">", "</span><span class="err">適用事業所番号</span><span class="nv">","</span><span class="err">法人番号</span><span class="nv">", "</span><span class="err">住所</span><span class="nv">","</span><span class="err">定年有無</span><span class="nv">" ,"</span><span class="err">定年年齢</span><span class="nv">", "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">希望者最低年齢</span><span class="nv">", "</span><span class="err">労働者総数レンジ</span><span class="nv">", "</span><span class="err">労働者総数</span><span class="nv">" ,"</span><span class="err">産業大分類名</span><span class="nv">", "</span><span class="err">都道府県名</span><span class="nv">"
    FROM "</span><span class="n">r3_61_227051by137_tab</span><span class="nv">"
    WHERE "</span><span class="err">定年有無</span><span class="nv">" == 2 OR
    "</span><span class="err">定年年齢</span><span class="nv">" &gt;= 70 OR
    "</span><span class="err">継続雇用</span><span class="o">-</span><span class="err">希望者最低年齢</span><span class="nv">" &gt;= 70 AND
    "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 94 AND
    "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 97 AND
    "</span><span class="err">産業中分類コード</span><span class="nv">" &lt;&gt; 98
  </span><span class="se">""</span><span class="nv">"</span>

<span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="k">cursor</span><span class="p">()</span>
<span class="o">#</span> <span class="n">db</span><span class="err">を</span><span class="n">pandas</span><span class="err">で読み出す。</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">cur</span><span class="p">.</span><span class="k">close</span><span class="p">()</span>
<span class="n">conn</span><span class="p">.</span><span class="k">close</span><span class="p">()</span></code></pre></figure>

<h4 id="２つのデータフレームをindexをkeyにmerge-する">２つのデータフレームをIndexをKeyにmerge する。<a class="header-link" href="http://localhost:4000/python_cheat_sheet/#%EF%BC%92%E3%81%A4%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%82%92index%E3%82%92key%E3%81%ABmerge-%E3%81%99%E3%82%8B" title="Permalink"><span class="sr-only">Permalink</span><i class="fas fa-link"></i></a></h4>

<p>Merge するキー列をIndexにするため、df.set_index(‘キー列名’)をする</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"事業所番号"</span><span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">df</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"事業所番号"</span><span class="p">)</span>
<span class="n">dfb</span> <span class="o">=</span> <span class="n">df</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfa</span><span class="p">,</span> <span class="n">dfb</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s">'inner'</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s">'事業所番号'</span><span class="p">)</span>
<span class="n">OR</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfa</span><span class="p">,</span> <span class="n">dfb</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s">'outer'</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s">'事業所番号'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>


    </section>
  </article>
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="http://localhost:4000/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">© 2023 so-wi.com. Powered by <a href="https://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="./Markdown Python Cheat Sheet_files/main.min.js.ダウンロード"></script>










  

</body></html>